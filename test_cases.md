# NooMiNav 测试用例文档

## 概述

本文档详细描述了 NooMiNav 项目的测试用例，包括功能测试、性能测试、安全测试和用户体验测试等各个方面。

## 测试环境

### 生产环境
- **平台**: Cloudflare Workers/Pages
- **数据库**: Cloudflare D1
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### 本地测试环境
- **平台**: Node.js 16+
- **框架**: Express.js
- **数据库**: 模拟 D1 数据库 (JSON 文件存储)
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

## 功能测试

### 1. 主页功能测试

#### TC-001: 主页正常加载
- **测试目的**: 验证主页能够正常加载并显示所有元素
- **前置条件**: 服务正常运行，环境变量配置正确
- **测试步骤**:
  1. 访问主页 URL
  2. 检查页面是否完全加载
  3. 验证标题、副标题、背景图片显示正确
  4. 检查所有导航项是否正常显示
  5. 验证友链是否正常显示
- **预期结果**: 页面完全加载，所有元素正常显示
- **优先级**: 高

#### TC-002: 搜索功能
- **测试目的**: 验证搜索功能能够正确过滤导航项
- **前置条件**: 主页已加载
- **测试步骤**:
  1. 在搜索框中输入关键词
  2. 检查匹配的项目是否显示
  3. 检查不匹配的项目是否隐藏
  4. 清空搜索框，检查所有项目是否重新显示
- **预期结果**: 搜索功能正常工作，正确过滤项目
- **优先级**: 高

#### TC-003: 主题切换功能
- **测试目的**: 验证主题切换功能正常工作
- **前置条件**: 主页已加载
- **测试步骤**:
  1. 点击主题切换按钮
  2. 检查页面主题是否改变
  3. 刷新页面，检查主题是否被记住
  4. 再次切换主题，验证功能
- **预期结果**: 主题切换正常，设置被保存
- **优先级**: 中

### 2. 链接跳转功能测试

#### TC-004: 主链接跳转
- **测试目的**: 验证主链接能够正确跳转
- **前置条件**: LINKS 环境变量配置正确
- **测试步骤**:
  1. 访问 `/go/{valid_id}` 路径
  2. 检查是否正确跳转到目标URL
  3. 验证数据库是否记录了访问日志
- **预期结果**: 正确跳转，访问被记录
- **优先级**: 高

#### TC-005: 备用链接跳转
- **测试目的**: 验证备用链接能够正确跳转
- **前置条件**: LINKS 环境变量中包含备用链接
- **测试步骤**:
  1. 访问 `/go/{valid_id}/backup` 路径
  2. 检查是否正确跳转到备用URL
  3. 验证数据库是否记录了访问日志
- **预期结果**: 正确跳转到备用链接，访问被记录
- **优先级**: 高

#### TC-006: 友链跳转
- **测试目的**: 验证友链能够正确跳转
- **前置条件**: FRIENDS 环境变量配置正确
- **测试步骤**:
  1. 访问 `/fgo/{valid_id}` 路径
  2. 检查是否正确跳转到友链URL
  3. 验证数据库是否记录了访问日志
- **预期结果**: 正确跳转，访问被记录
- **优先级**: 高

#### TC-007: 无效链接处理
- **测试目的**: 验证无效链接ID的错误处理
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 访问 `/go/{invalid_id}` 路径
  2. 访问 `/fgo/{invalid_id}` 路径
  3. 检查是否返回404错误
- **预期结果**: 返回404错误页面
- **优先级**: 中

### 3. 管理后台功能测试

#### TC-008: 管理员登录页面
- **测试目的**: 验证登录页面正常显示
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 访问 `/admin` 路径
  2. 检查登录页面是否正常显示
  3. 验证页面元素完整性
- **预期结果**: 登录页面正常显示
- **优先级**: 高

#### TC-009: 正确密码登录
- **测试目的**: 验证使用正确密码能够登录
- **前置条件**: admin 环境变量已设置
- **测试步骤**:
  1. 在登录页面输入正确的密码
  2. 提交登录表单
  3. 检查是否跳转到管理后台
  4. 验证是否设置了会话cookie
- **预期结果**: 成功登录，跳转到管理后台
- **优先级**: 高

#### TC-010: 错误密码登录
- **测试目的**: 验证使用错误密码无法登录
- **前置条件**: admin 环境变量已设置
- **测试步骤**:
  1. 在登录页面输入错误的密码
  2. 提交登录表单
  3. 检查是否显示错误消息
  4. 验证是否仍在登录页面
- **预期结果**: 显示错误消息，停留在登录页面
- **优先级**: 高

#### TC-011: 管理后台数据展示
- **测试目的**: 验证管理后台正确显示统计数据
- **前置条件**: 已登录管理后台
- **测试步骤**:
  1. 访问管理后台页面
  2. 检查各项统计数据是否正确显示
  3. 验证链接和友链数据是否正确加载
  4. 检查今日、本月、总计数据是否准确
- **预期结果**: 所有统计数据正确显示
- **优先级**: 高

#### TC-012: 访问日志查询
- **测试目的**: 验证能够查询特定链接的访问日志
- **前置条件**: 已登录管理后台，有访问记录
- **测试步骤**:
  1. 在管理后台点击某个链接卡片
  2. 检查右侧抽屉是否显示访问日志
  3. 验证日志时间格式是否正确
  4. 检查是否有最近的访问记录
- **预期结果**: 正确显示访问日志
- **优先级**: 中

#### TC-013: 管理员登出
- **测试目的**: 验证登出功能正常工作
- **前置条件**: 已登录管理后台
- **测试步骤**:
  1. 访问 `/admin/logout` 路径
  2. 检查是否清除会话cookie
  3. 验证是否跳转回登录页面
- **预期结果**: 成功登出，跳转到登录页面
- **优先级**: 中

### 4. API 接口测试

#### TC-014: 日志查询API
- **测试目的**: 验证日志查询API正常工作
- **前置条件**: 有访问记录，已登录或API开放
- **测试步骤**:
  1. 发送GET请求到 `/admin/api/logs?id={valid_id}&m={valid_month}`
  2. 检查返回的JSON格式
  3. 验证返回的数据是否正确
  4. 尝试查询不存在的链接ID
- **预期结果**: 返回正确的JSON数据或错误信息
- **优先级**: 中

## 性能测试

### 5. 响应时间测试

#### TC-015: 主页加载时间
- **测试目的**: 验证主页在合理时间内加载
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 访问主页
  2. 记录页面完全加载的时间
  3. 重复测试多次取平均值
- **预期结果**: 加载时间 ≤ 1000ms
- **优先级**: 中

#### TC-016: API 响应时间
- **测试目的**: 验证API接口在合理时间内响应
- **前置条件**: 服务正常运行，有数据记录
- **测试步骤**:
  1. 调用日志查询API
  2. 记录响应时间
  3. 重复测试多次取平均值
- **预期结果**: 响应时间 ≤ 500ms
- **优先级**: 中

#### TC-017: 高并发测试
- **测试目的**: 验证系统在高并发下的稳定性
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 使用工具模拟100个并发请求访问主页
  2. 记录成功率和响应时间
  3. 模拟100个并发请求进行链接跳转
  4. 检查数据库记录是否完整
- **预期结果**: 成功率 > 95%，响应时间 < 2000ms
- **优先级**: 低

## 安全测试

### 6. 身份验证测试

#### TC-018: 未授权访问防护
- **测试目的**: 验证未登录用户无法访问管理后台
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 不登录直接访问 `/admin`
  2. 检查是否被重定向到登录页面
- **预期结果**: 重定向到登录页面
- **优先级**: 高

#### TC-019: 密码长度验证
- **测试目的**: 验证系统对异常密码长度的处理
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在登录页面输入超长密码 (> 100字符)
  2. 提交登录表单
  3. 检查系统如何处理
- **预期结果**: 显示错误消息，拒绝登录
- **优先级**: 中

### 7. 输入验证测试

#### TC-020: SQL 注入防护
- **测试目的**: 验证系统对SQL注入攻击的防护
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在可能的输入点尝试SQL注入攻击
  2. 检查系统是否正确处理恶意输入
- **预期结果**: 恶意输入被正确处理，无SQL注入漏洞
- **优先级**: 高

#### TC-021: XSS 防护
- **测试目的**: 验证系统对XSS攻击的防护
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在可能的输入点尝试XSS攻击
  2. 检查系统是否正确处理恶意脚本
- **预期结果**: 恶意脚本被正确处理，无XSS漏洞
- **优先级**: 高

## 兼容性测试

### 8. 浏览器兼容性

#### TC-022: 主流浏览器测试
- **测试目的**: 验证应用在主流浏览器中正常工作
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在Chrome中测试所有功能
  2. 在Firefox中测试所有功能
  3. 在Safari中测试所有功能
  4. 在Edge中测试所有功能
- **预期结果**: 所有功能在各浏览器中正常工作
- **优先级**: 中

### 9. 设备兼容性

#### TC-023: 移动设备测试
- **测试目的**: 验证应用在移动设备上正常显示和操作
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在手机上访问主页
  2. 测试响应式布局
  3. 验证触摸操作
  4. 测试管理后台在移动设备上的可用性
- **预期结果**: 在移动设备上正常显示和操作
- **优先级**: 中

#### TC-024: 平板设备测试
- **测试目的**: 验证应用在平板设备上正常显示和操作
- **前置条件**: 服务正常运行
- **测试步骤**:
  1. 在平板上访问主页
  2. 测试响应式布局
  3. 验证触控操作
- **预期结果**: 在平板设备上正常显示和操作
- **优先级**: 低

## 用户体验测试

### 10. 可访问性测试

#### TC-025: 键盘导航测试
- **测试目的**: 验证可以通过键盘完成所有操作
- **前置条件**: 主页已加载
- **测试步骤**:
  1. 使用Tab键遍历页面元素
  2. 验证焦点指示器清晰可见
  3. 使用Enter或Space键激活链接和按钮
- **预期结果**: 可以通过键盘完成所有操作
- **优先级**: 低

#### TC-026: 屏幕阅读器兼容性
- **测试目的**: 验证应用对屏幕阅读器友好
- **前置条件**: 主页已加载
- **测试步骤**:
  1. 使用屏幕阅读器浏览页面
  2. 验证内容描述清晰
  3. 检查ARIA标签是否适当
- **预期结果**: 屏幕阅读器可以正确读取页面内容
- **优先级**: 低

## 错误处理测试

### 11. 异常情况处理

#### TC-027: 数据库连接失败
- **测试目的**: 验证数据库连接失败时的错误处理
- **前置条件**: 服务运行但数据库不可用
- **测试步骤**:
  1. 模拟数据库连接失败
  2. 访问主页
  3. 尝试进行链接跳转
  4. 检查错误处理
- **预期结果**: 显示适当的错误消息，不影响基本功能
- **优先级**: 中

#### TC-028: 环境变量缺失
- **测试目的**: 验证必要环境变量缺失时的处理
- **前置条件**: 缺少必要的环境变量
- **测试步骤**:
  1. 移除必要的环境变量
  2. 访问主页
  3. 检查是否有默认值或错误处理
- **预期结果**: 使用默认值或显示错误信息
- **优先级**: 中

## 本地测试环境测试

### 12. 本地模拟功能测试

#### TC-029: 本地服务器启动
- **测试目的**: 验证本地测试服务器能够正常启动
- **前置条件**: Node.js环境已安装，依赖已安装
- **测试步骤**:
  1. 运行 `node local_server_full_cf_simulation.js`
  2. 检查服务器是否正常启动
  3. 验证控制台输出信息
- **预期结果**: 服务器正常启动，显示启动信息
- **优先级**: 中

#### TC-030: 本地数据库模拟
- **测试目的**: 验证本地数据库模拟功能正常
- **前置条件**: 本地服务器已启动
- **测试步骤**:
  1. 进行链接跳转操作
  2. 检查数据是否被记录到本地文件
  3. 验证统计功能是否正常工作
- **预期结果**: 数据正确记录到本地文件，统计正常
- **优先级**: 中

#### TC-031: 本地管理后台
- **测试目的**: 验证本地环境管理后台功能
- **前置条件**: 本地服务器已启动
- **测试步骤**:
  1. 访问本地管理后台
  2. 使用默认密码登录
  3. 验证统计数据和日志显示
- **预期结果**: 管理后台功能正常，数据显示正确
- **优先级**: 中

## 回归测试

### 13. 核心功能回归

#### TC-032: 完整功能流程测试
- **测试目的**: 验证所有核心功能仍然正常工作
- **前置条件**: 服务正常运行，环境变量配置正确
- **测试步骤**:
  1. 访问主页并验证显示
  2. 测试搜索功能
  3. 测试链接跳转
  4. 测试管理后台登录
  5. 验证数据统计
- **预期结果**: 所有核心功能正常工作
- **优先级**: 高

## 自动化测试建议

### 14. 单元测试覆盖

#### TC-033: 工具函数测试
- **测试目的**: 验证各个工具函数的正确性
- **测试内容**:
  - [ ] 日期处理函数
  - [ ] JSON解析函数
  - [ ] 数据记录函数
  - [ ] 渲染函数

#### TC-034: 业务逻辑测试
- **测试目的**: 验证核心业务逻辑的正确性
- **测试内容**:
  - [ ] 访问统计逻辑
  - [ ] 用户认证逻辑
  - [ ] 数据查询逻辑

### 15. 集成测试覆盖

#### TC-035: API 集成测试
- **测试目的**: 验证API接口与其他组件的集成
- **测试内容**:
  - [ ] 数据库查询API
  - [ ] 认证API
  - [ ] 统计数据API

#### TC-036: UI 集成测试
- **测试目的**: 验证前端界面与后端服务的集成
- **测试内容**:
  - [ ] 表单提交处理
  - [ ] 数据展示功能
  - [ ] 交互功能

## 测试执行计划

### 每日构建测试
- 执行优先级为"高"的测试用例
- 重点关注核心功能

### 每周全面测试
- 执行所有"高"和"中"优先级的测试用例
- 包括性能和兼容性测试

### 发布前测试
- 执行所有测试用例
- 包括安全测试和用户体验测试

## 测试报告

### 通过标准
- 所有高优先级测试用例必须通过
- 至少90%的中优先级测试用例通过
- 关键功能的测试覆盖率不低于95%

### 失败处理
- 记录失败的测试用例及其原因
- 根据优先级确定修复顺序
- 严重问题需立即修复后才能继续

## 测试工具建议

### 自动化测试工具
- **Jest**: JavaScript单元测试
- **Cypress**: 端到端测试
- **Puppeteer**: 浏览器自动化测试
- **Artillery**: 性能测试

### 手动测试工具
- **Postman**: API测试
- **BrowserStack**: 跨浏览器测试
- **Lighthouse**: 性能和可访问性测试