# NooMiNav 项目规格文档

## 项目概述

**NooMiNav** 是一个基于 Cloudflare 生态构建的极简、高颜值云端服务导航门户。项目旨在为用户提供一个简洁、美观、功能强大的云端资源导航平台，支持多种部署方式和丰富的管理功能。

## 版本信息

- **当前版本**: V2.0 (增强版)
- **目标版本**: V3.0 (企业版)

## 当前功能特性

### 1. 基础功能
- ✅ 极简、高颜值的导航界面
- ✅ 支持毛玻璃（Glassmorphism）特效
- ✅ 隐私安全设计（配置通过环境变量注入）
- ✅ 支持备用链接配置
- ✅ 内置 D1 数据库集成
- ✅ 响应式布局
- ✅ 双模部署支持（Pages/Workers）
- ✅ 主题切换功能（亮色/暗色模式）
- ✅ 智能搜索和过滤功能
- ✅ 高级数据统计和可视化
- ✅ 用户行为分析
- ✅ 标签分类功能
- ✅ 性能优化（图片懒加载、缓存策略）

### 2. 数据管理
- ✅ PV、点击时间与来源记录
- ✅ 统计数据分类：总计、年度、月度、日度
- ✅ 最近访问时间记录
- ✅ 访问日志按月归档
- ✅ IP地址和User-Agent记录
- ✅ 实时数据更新

### 3. 管理功能
- ✅ 密码保护的管理后台
- ✅ 实时数据看板
- ✅ 点击热力图
- ✅ 详细访问日志
- ✅ 今日点击统计
- ✅ 顶部统计面板
- ✅ 月份选择器
- ✅ 数据导出功能（规划中）

### 4. 配置方式
- ✅ 环境变量配置
- ✅ JSON 格式数据存储
- ✅ 分离数据与代码
- ✅ 动态配置加载
- ✅ 配置验证机制

## 技术架构

### 前端技术栈
- **HTML5**: 现代网页标准结构
- **CSS3**: 毛玻璃效果、响应式布局、动画效果、主题切换
- **JavaScript (ES6+)**: 客户端交互、搜索功能、主题切换、性能优化
- **渐进增强**: 确保基础功能在各种环境下正常工作
- **无障碍访问**: 支持键盘导航和屏幕阅读器

### 后端技术栈
- **Cloudflare Workers**: 无服务器计算平台
- **Cloudflare Pages**: 静态网站托管
- **Cloudflare D1**: SQL 数据库服务
- **JavaScript (Node.js)**: 服务端逻辑处理
- **环境变量**: 配置管理，保证代码与数据分离
- **异步处理**: 非阻塞数据库操作

### 数据库设计
```sql
-- 日志表 (用于后台详情列表)
CREATE TABLE logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    link_id TEXT,
    click_time TEXT,
    month_key TEXT,
    ip_address TEXT DEFAULT 'unknown',
    user_agent TEXT DEFAULT 'unknown'
);

-- 创建索引优化查询性能
CREATE INDEX idx_logs_link_month ON logs(link_id, month_key);
CREATE INDEX idx_logs_time ON logs(click_time);

-- 统计表 (用于看板总览)
CREATE TABLE stats (
    id TEXT PRIMARY KEY,
    name TEXT,
    type TEXT,
    total_clicks INTEGER DEFAULT 0,
    year_clicks INTEGER DEFAULT 0,
    month_clicks INTEGER DEFAULT 0,
    day_clicks INTEGER DEFAULT 0,
    last_year TEXT,
    last_month TEXT,
    last_day TEXT,
    last_time TEXT
);
```

### API 接口设计
- **GET /**: 主页渲染
- **GET /admin**: 管理后台
- **POST /admin**: 管理员登录
- **GET /admin/logout**: 管理员登出
- **GET /admin/api/logs**: 日志查询API
- **GET /go/:id**: 主链接跳转
- **GET /go/:id/backup**: 备用链接跳转
- **GET /fgo/:id**: 友链跳转

## V3.0 增强计划

### 1. 用户体验优化
- [ ] 高级主题定制（用户自定义颜色方案）
- [ ] PWA 支持（离线访问）
- [ ] 多语言国际化（i18n）
- [ ] 语音搜索功能
- [ ] 快捷键支持
- [ ] 无障碍访问增强

### 2. 功能增强
- [ ] 多管理员支持
- [ ] 权限管理系统
- [ ] API 接口（RESTful）
- [ ] 第三方登录集成
- [ ] 用户个人中心
- [ ] 收藏夹功能
- [ ] 订阅通知功能

### 3. 界面升级
- [ ] 现代化UI设计（Material Design 3）
- [ ] 动画效果优化
- [ ] 交互反馈增强
- [ ] 图标库集成
- [ ] 拖拽排序功能

### 4. 性能优化
- [ ] 图片懒加载
- [ ] 预加载策略
- [ ] 缓存优化
- [ ] 代码分割
- [ ] CDN 优化
- [ ] 数据库查询优化

### 5. 安全增强
- [ ] CSRF 防护
- [ ] XSS 防护
- [ ] 速率限制
- [ ] 会话管理
- [ ] 数据加密
- [ ] 审计日志

### 6. 扩展功能
- [ ] 插件系统
- [ ] Webhook 支持
- [ ] 批量操作
- [ ] 自动备份
- [ ] 数据同步
- [ ] 第三方集成

## 当前限制和痛点

1. **实时监控**: 缺少实时数据推送功能
2. **高级分析**: 缺少用户行为分析和趋势预测
3. **多管理员**: 目前只支持单一管理员
4. **权限控制**: 缺乏细粒度权限管理
5. **通知系统**: 缺少异常通知和提醒功能
6. **API 接口**: 缺少标准化 API 接口
7. **移动适配**: 移动端体验仍有优化空间
8. **错误处理**: 异常处理机制需要完善

## 改进优先级

1. **高优先级**: 安全增强、多管理员支持
2. **中优先级**: API 接口、性能优化
3. **低优先级**: 高级功能、第三方集成

## 开发里程碑

### Milestone 1: 安全与权限 (V2.1)
- [ ] 多管理员支持
- [ ] 权限管理系统
- [ ] 安全增强机制
- [ ] 会话管理

### Milestone 2: API 与集成 (V2.2)
- [ ] RESTful API 接口
- [ ] 第三方登录
- [ ] Webhook 支持
- [ ] 数据导入导出

### Milestone 3: 用户体验 (V2.3)
- [ ] PWA 支持
- [ ] 多语言国际化
- [ ] 高级主题定制
- [ ] 无障碍访问

### Milestone 4: 高级功能 (V3.0)
- [ ] 插件系统
- [ ] 高级数据分析
- [ ] 自动化部署
- [ ] 企业级功能

## 部署配置要求

### 环境变量配置
- **必需变量**:
  - `admin`: 管理员密码
  - `LINKS`: 主导航链接配置 (JSON)
- **可选变量**:
  - `FRIENDS`: 友链配置 (JSON)
  - `TITLE`: 网站标题
  - `SUBTITLE`: 网站副标题
  - `img`: 背景图片URL
  - `CONTACT_URL`: 联系方式URL

### 数据库要求
- **D1 数据库绑定**: 必须绑定名为 `db` 的 D1 数据库
- **表结构**: 需要预先创建 logs 和 stats 表
- **索引**: 需要创建查询优化索引

## 测试要求

### 单元测试
- [ ] 路由处理函数
- [ ] 数据库操作函数
- [ ] 渲染函数
- [ ] 工具函数

### 集成测试
- [ ] API 接口测试
- [ ] 管理后台功能测试
- [ ] 跳转功能测试
- [ ] 数据统计准确性测试

### 用户验收测试
- [ ] 响应式设计测试
- [ ] 主题切换功能测试
- [ ] 搜索功能测试
- [ ] 数据看板功能测试

## 性能指标

### 响应时间
- 首页加载: ≤ 500ms
- API 响应: ≤ 200ms
- 管理后台: ≤ 1000ms

### 并发能力
- 同时在线用户: ≥ 1000
- QPS (每秒查询率): ≥ 1000

### 资源使用
- 内存占用: ≤ 128MB
- 数据库连接: ≤ 10个并发

## 安全考虑

### 数据安全
- 环境变量加密存储
- 数据库访问控制
- 用户隐私保护

### 应用安全
- 输入验证和清理
- 身份验证和授权
- 会话安全管理

### 网络安全
- HTTPS 强制使用
- CORS 策略配置
- DDoS 防护

## 维护计划

### 日常维护
- 监控系统运行状态
- 检查错误日志
- 数据备份验证

### 定期维护
- 数据库优化
- 安全补丁更新
- 性能调优

### 长期维护
- 功能更新
- 技术栈升级
- 架构重构